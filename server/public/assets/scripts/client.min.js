/*! personal_project 2016-05-06 */
var app=angular.module("dashboardApp",["ngRoute","ngMap"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"hc"}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"sc"}),b.html5Mode(!0)}]),app.controller("HomeController",["NgMap","LocationService","TransitService","WeatherService","CalendarService","$http",function(a,b,c,d,e,f){console.log("home controller loaded");var g=this;g.location=b.location,g.time=moment().format("hh:mm A"),g.umbrellaURL="assets/images/attire/umbrella-light.png",g.shortsURL="assets/images/attire/shorts-light.png",g.pantsURL="assets/images/attire/pants-light.png",g.jacketURL="assets/images/attire/jacket-light.png",g.mittensURL="assets/images/attire/mitten-light.png",g.tshirtURL="assets/images/attire/tshirt-light.png",g.stops=c.savedStops,g.selectedDepartureStop={},g.departures=c.departures,g.eventList=e.events,g.conditions=d.conditions,g.hourly=d.hourly,g.getDepartureInfo=function(){c.getDepartureInfo(g.selectedDepartureStop.route,g.selectedDepartureStop.direction,g.selectedDepartureStop.value),g.updateMap()},g.logMaps=function(){},e.getCalendarEvents(),d.getWeather(),c.getAllSavedStops(),b.getLocation(),g.updateMap()}]),app.controller("SettingsController",["LocationService","TransitService",function(a,b){console.log("settings controller loaded");var c=this;c.selectedRoute={},c.selectedDirection="",c.routes=b.routes,c.cardinalDirections=b.cardinalDirections,c.stops=b.stops,c.createStopResponse=b.createStopResponse,c.location={},c.setLocation=function(){a.setLocation(c.location.address,c.location.city,c.location.state,c.location.zip,c.location.weather,c.location.transit)},c.getRoutes=function(){b.getRoutes()},c.getDirection=function(){b.getDirection(c.selectedRoute)},c.getStops=function(){b.getStops(c.selectedRoute,c.selectedDirection)},c.createStop=function(){b.createStop(c.selectedStop,c.selectedRoute,c.selectedDirection)}}]),app.factory("TransitService",["NgMap","$http",function(a,b){var c=[],d=!1,e=!1,f={},g=[],h={value:0},i=[],j=[],k={},l=function(){b.get("/transit/routes").then(function(a){console.log("Got routes:",a),angular.copy(a.data,c)})},m=function(a){console.log("Getting directions for:",a),b.get("/transit/direction/"+a.Route).then(function(a){console.log("Got directions:",a.data);var b=a.data;"northSouth"===b?(d=!0,e=!1):(e=!0,d=!1),angular.copy({eastWest:e,northSouth:d},f),console.log("cardinalDirections",f)})},n=function(a,c){console.log("Getting stops for:",a,c),b.get("/transit/stops/"+a.Route+"/"+c).then(function(a){console.log("Got stops:",a.data),angular.copy(a.data,g)})},o=function(a,c,d){var e={name:a.Text,value:a.Value,route:c.Route,direction:d};b.post("/transit/create",e).then(function(a){console.log("Stop saved.",a.status),h.value=a.status},function(a){console.log("Stop not saved.",a.status),h.value=a.status})},p=function(){b.get("/transit/all").then(function(a){console.log("Retrieved stops from database:",a),angular.copy(a.data,i)})},q=function(c,d,e){console.log("Getting departure info for:",c,d,e),b.get("/transit/departure/"+c+"/"+d+"/"+e).then(function(b){console.log("Got departure info:",b.data),angular.copy(b.data,j),a.getMap({id:"map"}).then(function(a){k.lat=j[0].lat,k.lng=j[0].lng,console.log("busMarkerPosition",k);var b=new google.maps.Marker({position:k});b.setMap(a)})})};return{getRoutes:l,routes:c,getDirection:m,cardinalDirections:f,getStops:n,stops:g,createStop:o,createStopResponse:h,getAllSavedStops:p,savedStops:i,getDepartureInfo:q,departures:j}}]),app.factory("CalendarService",["$http",function(a){var b=[],c=function(){a.get("/calendar").then(function(a){console.log("client side calendar response:",a);var c=[];a.data.map(function(a){var b=moment(a.start).format("HH:mm"),d=moment(a.end).format("HH:mm");c.push({title:a.title,start:b,end:d})}),angular.copy(c,b)})};return{events:b,getCalendarEvents:c}}]),app.factory("WeatherService",["$http",function(a){var b=[],c={},d=function(){a.get("/weather").then(function(a){console.log("client side weather response:",a),angular.copy(a.data.conditionObject,c),angular.copy(a.data.hourlyList,b)})};return{hourly:b,conditions:c,getWeather:d}}]),app.factory("LocationService",["NgMap","$http",function(a,b){var c=0,d={},e={},f="/assets/images/transit/home.png",g={},h=function(a,d,e,f,g,h){var i={address:a,city:d,state:e,zip:f,weather:g,transit:h};b.post("/location",i).then(function(a){console.log("location posted successfully"),c=a.status})},i=function(){b.get("/location").then(function(b){console.log("Retrieved location:",b),angular.copy(b.data,d),a.getMap({id:"map"}).then(function(a){var b=new google.maps.Geocoder,c=d.address+" "+d.city+" "+d.state+" "+d.zip;b.geocode({address:c},function(b,c){console.log("results",b),e=b[0].geometry.location,a.setCenter(b[0].geometry.location),g=new google.maps.Marker({position:e,icon:f}),g.setMap(a)})})})};return{setLocation:h,locationResponseStatus:c,getLocation:i,location:d}}]);