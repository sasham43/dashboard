/*! personal_project 2016-05-10 */
var app=angular.module("dashboardApp",["ngRoute","ngMap","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"hc"}).when("/settings",{templateUrl:"/views/settings.html",controller:"SettingsController",controllerAs:"sc"}),b.html5Mode(!0)}]),app.controller("IndexController",["StyleService",function(a){var b=this;b.selectedStyle=a.savedStyles,b.showView=!1,b.fadeViewIn=function(){console.log("Faded in"),b["class"]="fadedIn",b.showView=!0},b.fadeViewOut=function(){console.log("Faded out"),b["class"]="fadedOut",b.showView=!1},a.getStyles()}]),app.controller("HomeController",["NewsService","NgMap","LocationService","TransitService","WeatherService","CalendarService","$http",function(a,b,c,d,e,f,g){console.log("home controller loaded");var h=this;h.location=c.location,h.time=moment().format("hh:mm A"),h.umbrellaURL="assets/images/attire/light_umbrella-light.png",h.shortsURL="assets/images/attire/light_shorts-light.png",h.pantsURL="assets/images/attire/light_pants-light.png",h.jacketURL="assets/images/attire/light_jacket-light.png",h.mittensURL="assets/images/attire/light_mitten-light.png",h.tshirtURL="assets/images/attire/light_tshirt-light.png",h.stops=d.savedStops,h.selectedDepartureStop={},h.departures=d.departures,h.arrivalText=d.arrivalText,h.eventList=f.events,h.conditions=e.conditions,h.hourly=e.hourly,h.articleList=a.articleList,h.getDepartureInfo=function(){h.selectedDepartureStop&&d.getDepartureInfo(h.selectedDepartureStop.route,h.selectedDepartureStop.direction,h.selectedDepartureStop.value)},h.showDepartureInfo=function(){return null===h.selectedDepartureStop||void 0===h.selectedDepartureStop.value?(h.departureInfoClass="fadedOut",!1):(h.departureInfoClass="fadedIn",!0)},h.currentIndex=0,h.setCurrentIndex=function(a){h.currentIndex=a},h.isCurrentIndex=function(a){return h.currentIndex===a},h.next=function(){h.currentIndex===h.articleList.length-1?h.currentIndex=0:h.currentIndex++},h.previous=function(){0===h.currentIndex?h.currentIndex=h.articleList.length-1:h.currentIndex--},f.getCalendarEvents(),e.getWeather(),d.getAllSavedStops(),c.getLocation(),a.getNews()}]),app.controller("SettingsController",["StyleService","LocationService","TransitService",function(a,b,c){console.log("settings controller loaded");var d=this;d.selectedRoute={},d.selectedDirection="",d.routes=c.routes,d.cardinalDirections=c.cardinalDirections,d.stops=c.stops,d.createStopResponse=c.createStopResponse,d.editStops=c.savedStops,d.selectedDepartureStop={},d.selectedStyle={},d.currentLocation=b.location,d.location={},d.setLocation=function(){b.setLocation(d.location.address,d.location.city,d.location.state,d.location.zip,d.location.weather,d.location.transit)},d.getRoutes=function(){c.getRoutes()},d.getDirection=function(){d.selectedRoute&&c.getDirection(d.selectedRoute)},d.getStops=function(){c.getStops(d.selectedRoute,d.selectedDirection)},d.createStop=function(){c.createStop(d.selectedStop,d.selectedRoute,d.selectedDirection)},d.cancelCreateStop=function(){d.stops.length=0,d.routes.length=0,c.clearCardinalDirections()},d.editBusStops=function(){c.getAllSavedStops()},d.removeBusStop=function(){c.removeBusStop(d.selectedDepartureStop)},d.saveStyles=function(){a.saveStyles(d.selectedStyle)},d.getStyles=function(){a.getStyles()},b.getLocation()}]),app.factory("TransitService",["NgMap","$http",function(a,b){var c=[],d=!1,e=!1,f={},g=[],h={value:0},i=[],j=[],k={},l="/assets/images/transit/tiny_bus_icon.png",m="",n=function(){b.get("/transit/routes").then(function(a){console.log("Got routes:",a),angular.copy(a.data,c)})},o=function(a){console.log("Getting directions for:",a),b.get("/transit/direction/"+a.Route).then(function(a){console.log("Got directions:",a.data);var b=a.data;"northSouth"===b?(d=!0,e=!1):(e=!0,d=!1),angular.copy({eastWest:e,northSouth:d},f),console.log("cardinalDirections",f)})},p=function(a,c){console.log("Getting stops for:",a,c),b.get("/transit/stops/"+a.Route+"/"+c).then(function(a){console.log("Got stops:",a.data),angular.copy(a.data,g)})},q=function(a,c,d){var e={name:a.Text,value:a.Value,route:c.Route,direction:d};b.post("/transit/create",e).then(function(a){console.log("Stop saved.",a.status),h.value=a.status},function(a){console.log("Stop not saved.",a.status),h.value=a.status})},r=function(){b.get("/transit/all").then(function(a){console.log("Retrieved stops from database:",a),angular.copy(a.data,i)})},s=function(c,d,e){console.log("Getting departure info for:",c,d,e),b.get("/transit/departure/"+c+"/"+d+"/"+e).then(function(b){console.log("Got departure info:",b.data),angular.copy(b.data,j),j[0].departureText.includes("Min")?(console.log("min true"),j[0].arrivalText="Your bus will arrive at your selected stop in:"):j[0].departureText.includes(":")?(console.log(": true"),j[0].arrivalText="Your bus will arrive at your selected stop at:"):j[0].departureText.includes("Due")&&(j[0].arrivalText="Your bus will be arriving shortly.",j[0].departureText=""),console.log("departures[0]:",j[0]),a.getMap({id:"map"}).then(function(a){k.lat=j[0].lat,k.lng=j[0].lng,console.log("busMarkerPosition",k);var b=new google.maps.Marker({position:k,icon:l});b.setMap(a)})})},t=function(a){b["delete"]("/transit/remove/"+a._id).then(function(a){console.log("Removed bus stop"),r()})},u=function(){angular.copy({eastWest:!1,northSouth:!1},f)};return{getRoutes:n,routes:c,getDirection:o,cardinalDirections:f,getStops:p,stops:g,createStop:q,createStopResponse:h,getAllSavedStops:r,savedStops:i,getDepartureInfo:s,departures:j,removeBusStop:t,clearCardinalDirections:u,arrivalText:m}}]),app.factory("CalendarService",["$http",function(a){var b=[],c=function(){a.get("/calendar").then(function(a){console.log("client side calendar response:",a);var c=[];a.data.map(function(a){var b=moment(),d=moment(a.start),e=moment(a.start).format("ddd MMM D"),f=moment(a.end),g=moment(a.start).format("HH:mm"),h=moment(a.end).format("HH:mm"),i=!1;i=b.dayOfYear()===moment(a.start).dayOfYear(),c.push({title:a.title,dateStart:d,start:e,end:f,timeStart:g,timeEnd:h,isToday:i})}),angular.copy(c,b)})};return{events:b,getCalendarEvents:c}}]),app.factory("WeatherService",["$http",function(a){var b=[],c={},d=function(){a.get("/weather").then(function(a){console.log("client side weather response:",a),angular.copy(a.data.conditionObject,c),angular.copy(a.data.hourlyList,b)})};return{hourly:b,conditions:c,getWeather:d}}]),app.factory("LocationService",["NgMap","$http",function(a,b){var c=0,d={},e={},f="/assets/images/transit/home.png",g={},h=function(a,d,e,f,g,h){var j={address:a,city:d,state:e,zip:f,weather:g,transit:h};b.post("/location",j).then(function(a){console.log("location posted successfully"),c=a.status,i()})},i=function(){b.get("/location").then(function(b){console.log("Retrieved location:",b),angular.copy(b.data,d),a.getMap({id:"map"}).then(function(a){var b=new google.maps.Geocoder,c=d.address+" "+d.city+" "+d.state+" "+d.zip;b.geocode({address:c},function(b,c){console.log("results",b),e=b[0].geometry.location,a.setCenter(b[0].geometry.location),g=new google.maps.Marker({position:e,icon:f}),g.setMap(a)})})})};return{setLocation:h,locationResponseStatus:c,getLocation:i,location:d}}]),app.factory("StyleService",["$http",function(a){var b={},c={},d=function(){a.get("/style/apod").then(function(a){console.log("Got APOD:",a),angular.copy(a.data,b)})},e=function(b){a.put("/style/save",b).then(function(a){console.log("Styles posted successfully."),f()})},f=function(){a.get("/style/all").then(function(a){console.log("Got styles:",a),angular.copy(a.data,c)})};return{apod:b,getAPOD:d,saveStyles:e,getStyles:f,savedStyles:c}}]),app.factory("NewsService",["$http",function(a){var b=[],c=function(){a.get("/news/viewed").then(function(a){console.log("Client side news response:",a),angular.copy(a.data.results,b)})};return{getNews:c,articleList:b}}]);